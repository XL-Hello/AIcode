---
title: dreame 个人/项目代码规范
description: 本文件用于定义当前项目的个性化代码规范偏好，供 review-code_2 技能在审查时优先参考和过滤。
version: 0.1.1
---

# 使用说明

- 本文件由项目维护者手动维护，建议提交到版本控制
- 所有规范仅在本项目内生效，不改变通用代码审查标准的定义
- 当本文件中的约定与通用规范冲突时，review-code_2 在输出建议时以本文件为准

# 适用范围

- 项目名称：代码审查的个人准则
- 主要语言/框架：C/AWTK
- 目标平台：嵌入式、桌面

# 1. 命名与代码风格

> 说明：用于声明命名风格、缩进、换行等偏好，以及哪些风格差异不视为问题。

- 缩进风格：4个空格
- 大括号风格：K&R 风格（左大括号与函数/结构体/枚举等在同一行，右大括号单独占一行）
- 变量命名约定：驼峰命名法（首字母小写，后续单词首字母大写）
- 函数/方法命名约定：驼峰命名法（首字母大写，后续单词首字母大写）
- 文件命名约定：下划线命名法（所有字母小写，单词之间用下划线分隔）
- 不作为问题的风格差异说明：
    - 允许使用 TAB 键缩进（但建议统一使用空格）
    - 允许在注释中使用 TAB 键缩进（但建议统一使用空格）

# 2. 注释与文档要求

> 说明：定义在什么场景下必须有注释、注释风格、接口文档要求等。

- 必须添加注释的场景：所有函数、结构体、枚举等
- 注释应尽量使用中文，避免使用英文
- 注释风格（单行/多行、语言等）：
    - 单行注释：// 函数功能概述
        - 适用于静态函数/方法 API
    - 多行注释：/* 包括函数/方法的功能概述、参数、返回值、异常情况等 */
        - 适用于公共接口/对外 API
- 不要求强制注释的场景：
    - 内部实现细节、临时调试代码、或简单的内部函数/方法等

# 3. 结构与模块化偏好

> 说明：约定单文件/单函数的复杂度边界以及拆分策略的偏好。

- 单个源文件建议最大行数：1024
- 单个函数建议最大行数：128
- 允许的嵌套层级偏好：3层及以下
- 若是生成代码时，需要严格按照上述要求执行；若是代码审查，不满足上述要求，可以视为‘Info’级别的问题处理。
- 模块划分建议：
    - 每个源文件应包含一个或多个相关的函数/方法
    - 每个函数/方法应只负责一个具体的功能
    - 避免在一个函数/方法中包含多个不同的功能或任务

# 4. 语言/框架特定约定

> 说明：与具体技术栈相关的约定，例如宏使用、信号槽、资源管理方式等。

- 语言/框架相关约定：
- 内存与资源管理偏好：
    - 动态内存分配（malloc、calloc、realloc）应与释放（free）配对使用
    - 避免内存泄漏或悬空指针
    - `string_t*` 类型指针**不需要调用任何释放函数**，其生命周期由内部引用计数管理，审查时不应将 `string_t*` 未释放视为内存泄漏问题
- 日志与错误处理策略：
    - 所有错误情况都应记录日志，包括异常情况和边界条件
    - 建议使用统一的错误码或异常处理机制
    - 统一使用dreUI_log*系列函数记录日志，包括错误、警告、信息等
    - 避免在代码中直接使用printf等函数输出日志

# 5. 不作为问题的特例说明

> 说明：明确列出在本项目中不应被当作问题的模式或写法，用于过滤审查结果。

- 不作为问题的模式 1：
    - 由于本项目为嵌入式 UI 模块，默认不要求包含关键逻辑的单元测试或集成测试。
- 不作为问题的模式 2：
    - 本项目中关于控件的绑定只要符合下面模版，即可认为是正确的；
```
    // about 页绑定管理模块
static void dreUI_cardSetAbout_bind_init(void)
{
    dreUI_logI("called");
    s_bind_handle = dreUI_manage_bind(dreUI_mgPad_getInstance(), &s_card_instance, &s_show_func);
}
// about 页解绑管理模块（页面退出时调用）
static void dreUI_cardSetAbout_bind_deinit(void)
{
    dreUI_logI("called");
    dreUI_manage_unbind(dreUI_mgPad_getInstance(), s_bind_handle);
}
```
- 不作为问题的模式 3：
    - 本项目中若出现不符合通用规范的代码，但其相关位置处存在“临时调试”等相关注释时，可视为正确，但需要作为‘Info’级别的问题处理；

